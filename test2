On-lineNoveltyDetection UsingtheKalmanFilterandExtremeValueTheory Hyoung-jooLee,StephenJ.Roberts DepartmentofEngineeringScience,UniversityofOxford ParksRoad,OX13PJ,Oxford,UK hjlee@robots.ox.ac.uk,sjrob@robots.ox.ac.uk Abstract Noveltydetectionisconcernedwithidentifying abnormal systembehavioursandabrupt changes fromoneregimetoanother.Thispaperproposes anon-line(causal)noveltydetectionmethodcapableofdetectingbothoutliersandregimechange points in sequential time-series data. Our approach is basedonaKalmanfilter inorder to model time-seriesdataandextremevaluetheory isusedtocomputeanoveltymeasureinaprincipledmanner.Theproposedapproachisshownto beeffectiveviaexperimentsonseveral real-world datasets. 1 Introduction Thegoalofnoveltydetectionistoidentifyabnormal systembehaviourswhicharenotconsistentwiththe“normal”(ordominant)stateofa system[4]. Suchanapproachhasbeenofgreat importanceinvariousdomainswhereasevereimbalance existsbetweennumbers of examples in differing classes or incases inwhich thenovel “class” cannot beuniquelydefinedbut system “normality”canbe. Examples includecondition monitoring, identityverification, financial data analysisandbiomedicalsignalprocessing. Formanypracticalapplications, inparticular intime-seriesdomainssuchasfinance,anovelty takesplace fortwodifferentreasons. Firstly, an outlierariseswhenanobservationdeviatesfrom astaticnorm[2]. Anoveltycanalsobeoserved whenthenormitselfchangesdynamically, i.e. at achangepoint [3]. These twotypesofnovelty, althoughcloselyrelated, havehithertobeenapproachedseparately. This paper proposes an on-line novelty detectionmethod capable of detectingbothoutliersandchangepoints intime-seriesdata. The Kalmanfilter[5] isemployedtoestimatedynamicallytheprobabilitydensityof thetargetdata. It is assumed that adeviation in the observationspaceindicatesanoutlierwhereasoneinthe statespace(whichdefinesthedynamicalmodelof thedata)representsachangepointbetweendynamicregimes. Inordertoderiveamoreprincipledandintuitivenoveltymeasurefromtheestimateddensity,extremevaluetheory, inthesemianalytic frameworkdescribed in [7], isadopted. Theproposedapproachis showntobeeffective throughexperimentsonartificialandreal-world time-seriesdatasets. 2 ProposedApproach Thissectionpresentsthemainideaoftheproposed approach. In particular, we firstly describetheKalmanfiltermultivariateautoregressionmodel [6] viawhicha (multivariateGaussian)probabilitydensityoverthetargetvariables canbeobtained. Secondly,weintroduceextreme value theory(EVT)whichprovidesournovelty measure.Wecanmodelthedynamicsofthestate spaceusingtheKalmanfilter,anddetectchanges oftheunderlyingsystemaswellasoutliersinthe observationsequence.On-linedetectionispossiblesincesequentialmodellingissufficientforthe Kalmanfilter. Furthermore,EVTenablesus to obtainanoveltymeasureanddetermineathresholdinamoreprincipledmannerratherthanjust thresholdingaprobabilitydensity. 2.1 Kalmanfilterautoregression Suppose a data set {yt}T t=1, where yt = [yt,1,...,yt,d] ∈Rd. Inordertomodelthedata, aKalmanfiltermultivariateautoregressionmodel [6] isconsideredasfollows: at=at−1+wt, wt∼N(0,Wt), (1) yt=Htat+vt, vt∼N(0,Vt). (2)Withthestatetransitionmatrixassumedtobe identity(i.e. wedonotbelievetheretobesystematic trends in thedata in these examples), the state variable, at ∈Rk, follows aGaussian diffusion process withMarkovian dynamics. The observationmatrix,Ht ∈Rd×k consists of thepast observations of the time-series in these examples (though there is no reason whythiscouldnotbeanyobservabledata), i.e. Ht= 1,y1 t−1,...,yd t−1,...,y1 t−p,...,yd t−p ⊗Id, where p is anARmodel order, ⊗is theKroneckerproduct,andId isa(d×d) identitymatrix.Hence,eqs.(1-2)specifyasystemwhere,at timet, thestate isasetof time-varyingARcoefficientsandtheobservation is estimatedbya multivariateARmodelwithamodelorderofp. Without going into details, estimating the variables,at,wt,andvt, is identical tothestandardKalmanfilter, alternating prediction and update. Theestimatedprobabilitydensityfunctionscanbewrittenasfollows,repectively, p(ˆat)=N(ˆat−1,Pt), (3) p(yt)=N(Htˆat−1,St). (4) Theestimatedcovariancesare,respectively,Pt= (I−KtHt)(Pt−1+Wt)andSt=Vt+Ht(Pt+ Wt)Ht ,whereKt=(Pt−1+Wt)HtV−1 t isthe Kalmangain. Theaboveprobabilitydensitiescanbeusedas noveltymeasureswithanappropriatethresholding. Lowdensities intheobservationspacecorrespondtooutlierswhichdeviate fromthe systemnorm. Ontheotherhand, lowdensities in thestatespacesuggestthatthestatisticsof the underlyingsystemarechangingi.e. potentialdynamicregimechangesaretakingplace. Tofind appropriatethresholds intheabsenceof labeled dataweusethenotionofextremevalues,asdetailedbelow. 2.2 Extremevaluetheory(EVT) Whennoveltydetectionisperformedbasedon estimationof aprobabilitydensity function, a constant thresholdis typicallyusedsuchthata datapoint is considerednovel if itsprobability densityislowerthanthethreshold.Thisisequivalenttoimplicitlyassumingauniformdensityfor thenovel class andthencarryingoutdiscriminant analysis. However, it canbeproblematic sincetheuniformdensityisgenerallynotanappropriatedistribution. Inaddition,determining thethresholdisdata-dependent. Forexample,a thresholdof 0.1couldbeperfect for somedata set,but itcouldbeadisaster foranother, especiallyinahigh-dimensionalspace. Extremevaluetheory(EVT)canbeanalternative [7]. Supposeaset,Zm={zi}m i=1withm i.i.drandomvariablesdrawnfromatargetdistribution,D.Theextremevalueprobability(EVP) ofz isaprobabilityof zbeingthe largestvalue intheset, i.e. PEV(z|Zm)=P(max(Zm)≤z). BytheFisherandTippett theorem, anEVPis expressedas thegeneralisedextremevaluedistributionwhich is generallynot easy to evaluate. However, if the target distribution is assumedtobetheone-sidedstandardGaussian,i.e. D=|N(0,1)|, theEVPisanalyticallyobtained intheformoftheGumbeldistribution: PEV(z|Zm)=exp −exp −z−µm σm , (5) whereµm=(2lnm)1/2−ln(lnm)+2π 2(2lnm)1/2 andσ= (2lnm)−1/2. Notethat the“norming”parameters,µmandσm,dependonlyonthenumberof data,m, intheset.WeuseanotationPEV(z|m) forPEV(z|Zm)throughoutthispaper. AssumingtheGaussiannoiseprocessesforthe stateandobservationvariablesintheKalmanfiltermodel, eq.(5)canbeapplieddirectlytoour noveltydetectionapproach. AMahalanobisdistance, (x−mx) C−1 x (x−mx), (6) is considered to be distributed as |N(0,1)| if x is Gaussian. Therefore, we can obtain EVPs of at and yt as in eq.(5) by replacing {x,mx,Cx}ineq.(6)with{ˆ at,ˆ at−1,Pt}ineq.(3) and{yt,Htˆ at−1,St}ineq.(4),respectively. InordertoevaluateanEVPas ineq.(5), the numberofdata,m,shouldbespecified.Weadopt theconceptofrunlengthwhichmeanstimesince thelastoutlierorchangepoint[1]. Itisassumed thattherunlengthisresetto1ifanoveltyarises oraddedby1 ifnonoveltyisobserved. Hence, at time t, the run length, t, stochasticallyhas binaryvalues, t= 1, withPr=PEV(t−1), t−1+1,withPr=1−PEV(t−1), wherePEV(t)canbeeitherPEV(at)orPEV(yt), and 1 =1. In turn, wehave the run length probability, P( t=m)= PEV(t−1), form=1, (1−PEV(t−1))P( t−1=m−1), form≥2, whereP( 1=1)=1. Aswearenotdirectly interestedinm,weobtaintheEVPbymarginalisingouttherunlength, PEV(t)= t m=1 PEV(t| t=m)P( t=m). TheEVPcanbeusedasanoveltymeasure;a noveltyflagisraisedif itexceedssomethreshold, θEV.Thatis,anoutlierisdetectedifPEV(at)≥ θEV, or achangepoint ifPEV(yt)≥θEV. In thispaper,we set θEV =0.95. UsinganEVP asanoveltymeasurehasafewadvantagesover thresholding the probability density. First, it makesmoretheoreticalsensewithoutmakingan inappropriate assumptionof auniformdensity over thenovel class. Second, it ismore interpretable sinceaEVPismore recognisablewith aspike-likeshapewhenanoveltyarises, aswill beshowninthenextsection. Third, it is inthe formofprobability, sosettingthethresholdata reasonablevalue, e.g. 0.95,works formostdata sets. Ontheotherhand, aprobabilitydensity hasdifferent scales fordifferentdatasets. The thresholdcanbedeterminedonlyafterexaminingthedensityfor thewholedataset,whichis impossibleandundesirablefornoveltydetection. 3 ExperimentalResults This sectionpresentsexperimental resultson threedatasets: anartificialdataset, theWellLogdataset, andtheDowJonesdataset. Althoughallof themareonedimensional for illustrationpurposes,extendingtomulti-dimensional dataisstraightforward.Foreachdataset,asimpleARmodelwasappliedtoa“run-in”period of first 100 time steps tochoose themodel order pand the initial noises,W0 andV0. All theKalmanfilterARmodelswerefirst-order, i.e. p=1exceptforthewell-logwhereitwassecondorder. Figure1showstheresultsontheartificialdata setwhichwasgeneratedbyalternatingfirst-order and zeroth-order randomwalks (upper). The changepointsbetweendifferentorderswerechosentobeatt=250,500,and750while“one-off” outliersweregeneratedat t=200,400,600and 800.TheobservationsandtheestimatedARcoefficientsare shown intheupperandthe lower panels, respectively. Thevertical lines indicate novelties detectedbyour noveltydetector. In theobservationspace(upper),thedetectoridentifiedall fouroutliersandtwochangepointsout of three. However, it failedtodetect achange pointat t=250. Inthestatespace(lower), on theotherhand, it identifiedall fouroutliersand all threechangepointswhile it raisedone false alarmataroundt=720.Consideringthesimilar 0 100 200 300 400 500 600 700 800 900 1000 −2 −1.5 −1 −0.5 0 0.5 1 1.5 Time Observation 0 100 200 300 400 500 600 700 800 900 1000 −2 −1 0 1 2 Time Parameter value Figure1.Artificialdataset 0 100 200 300 400 500 600 700 800 900 1000 −6 −4 −2 0 2 Time Observation 0 100 200 300 400 500 600 700 800 900 1000 −2 −1 0 1 2 3 Time Parameter value Figure2.Well-Logdataset results inbothspaces,wesuppose thatdistinctionbetweenoutliersandchangepoints isvague inthisdataset. TheWell-Logdatasetcontainsmeasurements ofnuclearmagneticresponsewhiledrillingawell. Figure 2 shows the results froma latter part, about1,000timesteps.Theobservationsequence hassomevariations inbaseline, andadeepvalley. Intheobservationspace(upper),ourdetectorpickeduptwodeviations inbaselineandthe valley,butnot tworeturns tothenorm. Inthe state space (lower), itdetectedall thebaseline variations and the valley. It caught twoother pointsasnoveltiesat t=620and910. Looking atthemclosely,therearesubtlechangesatthose pointsinfrequencyandmagnitudeofthesignal. Figure3showstheresultsonthedailyreturns oftheDowJonesIndustrialAveragefrom1972to 1975.Despitenoevidentoutlierorchangepoint, thereweresomeeventsmuchrelevanttothemarket, i.e. thedashedvertical lines: (A) convictionofNixon’s formeraides (30Jan1973), (B) beginningof theOPECembargo(19Oct1973), and(C)resignationofNixon(09Aug1974).The noveltydetectordidnotnoticeanyoutliersinthe0 100 200 300 400 500 600 700 −3 −2 −1 0 1 2 3 4 Time Observation 0 100 200 300 400 500 600 700 −3 −2 −1 0 1 2 3 Time Parameter value (A) (B) (C) Figure3.DowJonesdataset observationspace.However, itdididentifysome changepoints inthestatespace. Itdidnotpredictthefirstchangepointortheconvictionevent, butitrecognisedsomesubtlechangesinthemarketwhichhadhappenedalittlebeforetheevent. Itdetectedthesecondchangepointa little late andthelastoneaccurately. Figure4compares theEVP(upper)andthe noise density (lower) in the observation space of the artificial data set to illustrate practical usefulnessofEVT.The thickhorizontal line in the upper panel indicates theEVP threshold, θEV =0.95. TheEVPismucheasier to interpret, since ithas spikeswhere ithas toand is relativelyflatelsewhere.Thenoisedensityoscillatesoverthewholeperiod. Furthermore,while theEVPis inaformofaprobability, thenoise densityisnotwiththerange from0toroughly 12. Themaximumvalues of thenoisedensity wereapproximately1and0.5 for theWell-Log andtheDowJonesdataset, respectively. Asa result, eventhoughnovelties couldbedetected bythenoisedensity, thethresholdshouldbeoptimisedforaspecificdataset,whichisdifficult andundesirablefornoveltydetection. 4 Conclusion Thispaperproposesanon-linenoveltydetectionapproach for time-series data, by employingacombinedKalmanfilterandextremevalue theory framework. Workingboth intheobservationandstate space,we candetectnot only outlierswhereobservationsareclearoutliers,but alsochangepointswheretheunderlyingsystem changesdynamically.Experimentsonthreedata setshaveshownpromisingresults. Afewfuture researchdirections need tobe addressed. First, as we have employed the Kalmanfilter,weassume lineartransformations 0 100 200 300 400 500 600 700 800 900 1000 0 0.2 0.4 0.6 0.8 1 Time EV probability 0 100 200 300 400 500 600 700 800 900 1000 0 2 4 6 8 10 12 14 Time Noise probability density Figure4.EVPandnoisedensity andGaussiannoises. Inordertodealwithgeneralsituationswithnon-lineartransformationsor non-Gaussiannoises, wemayneed to consider particlefiltersorgeneralizedextremevaluetheory. Second,wefixedthemodel order for each dataset. Inamoregeneral scenario,however, it maychangeovertime.Thedynamicmodelorder canmakeestimationmoreaccurate,andmoreimportantly, thechange inthemodelordercanbe regardedasachangepoint. Finally,weneedto evaluatenoveltydetectionperformancefortimeseriesdatamorequantitatively. Acknowledgments ThisworkwassupportedbytheKoreaResearch FoundationGrantfundedbytheKoreanGovernment(MOEHRD)(KRF-2007-357-D00276).
